#
# .bazelrc
#
common --enable_bzlmod=true

# Disable WORKSPACE file
#common --noenable_workspace

# Configuration for using Buildbarn on hp4.home
# Use 'build:hp4' to apply these flags to the build command when --config=hp4 is used
build:hp4 --remote_executor=grpc://hp4:8980
#build:hp4 --remote_cache=grpc://hp4.home:8980
# Worker {"datacenter":"amsterdam","hostname":"ubuntu-worker.example.com","rack":"3","slot":"10","thread":"4"}
build:hp4 --remote_instance_name=fuse
build:hp4 --remote_default_exec_properties=OSFamily=linux
#build:hp4 --remote_default_exec_properties=container-image=docker://ghcr.io/catthehacker/ubuntu:act-22.04@sha256:5f9c35c25db1d51a8ddaae5c0ba8d3c163c5e9a4a6cc97acd409ac7eae239448
build:hp4 --remote_default_exec_properties=container-image=docker://randomizedcoder/nix-bbrunner-noupx-dev:latest

build:hp4 --remote_timeout=3600

build:hp4 --spawn_strategy=remote

#build:hp4 --action_env=LD_LIBRARY_PATH=/lib

# build:hp4 --action_env=CGO_ENABLED=1
# build:hp4 --action_env=CGO_CFLAGS=-Izlib/include
# build:hp4 --action_env=CGO_LDFLAGS=-lz

build:hp4 --shell_executable='/home/nobody/bash.wrapper'

# go-with-sysroot/bin/cc wrapper
try-import .bazelrc.generated

build:race --features=race
build:race --@io_bazel_rules_go//go/config:race

build:local-sysroot --action_env=PATH=$PWD/result/bin
build:local-sysroot --action_env=CPATH=$PWD/result/include
build:local-sysroot --action_env=LIBRARY_PATH=$PWD/result/lib
build:local-sysroot --action_env=CGO_ENABLED=1
#build:local-sysroot --action_env=CC=clang
build:local-sysroot --action_env=CGO_CFLAGS="-I$PWD/result/include"
build:local-sysroot --action_env=CGO_LDFLAGS="-L$PWD/result/lib"
build:local-sysroot --action_env=CC=$PWD/cc_wrapper.sh

build:local-sysroot --repo_env=CC=$PWD/cc_wrapper.sh
build:local-sysroot --repo_env=CPATH=$PWD/result/include
build:local-sysroot --repo_env=LIBRARY_PATH=$PWD/result/lib
build:local-sysroot --repo_env=CGO_CFLAGS="-I$PWD/result/include"
build:local-sysroot --repo_env=CGO_LDFLAGS="-L$PWD/result/lib"

# end